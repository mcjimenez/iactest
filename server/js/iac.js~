(function(exports) {

  'use strict';

  function ServerIAC() {
    navigator.mozSetMessageHandler('connection', this.onConnection.bind(this));
  }

  ServerIAC.prototype = {
    count: 0,
    onConnection: function(request) {
      if (request.keywork !== 'testIAC') {
        console.log('This is not our connection request. Keywork ' +
                    request.keywork);
        return;
      }
      var port = this.port = request.port;
      port.onmessage = this.onmessage.bind(this);
      port.start();
    },
    onmessage: function(evt) {
      var data = evt.data;
      console.log ('CJC - server. Received:' + JSON.stringify(evt.data));
    },
    sendMsg: function() {
      console.log('CJC - server sending a msg(' + this.count);

      var msg = {
        txt: 'Server sends msg ' + this.count++
      };

      this.port.postMessage(msg);
    }
  };
})();
